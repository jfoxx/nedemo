@use '../../styles/ne-global-imports' as *;
@use 'sass:meta';
@use 'sass:math';

$uswds-block: 'usa-banner';

.form-wrapper {
	@include meta.load-css('~uswds/uswds-form-controls/index'); // avoid affecting top search

	margin-bottom: units($component-spacing-sm);

	&__header-text {
		@include u-padding-y(1.5);
	}
	
	.usa-form {
		display: grid;
		grid-template-columns: repeat(12, minmax(0, 1fr));
		gap: 0 units(4);
		max-width: none; // Override USWDS default max-width constraint
	}
	
	// Remove USWDS max-width constraints on form elements
	.usa-label,
	.usa-legend,
	.usa-input,
	.usa-select,
	.usa-textarea,
	.usa-combo-box,
	.usa-file-input,
	p {
		max-width: none;
	}

	// Hide all legend elements in the form
	legend,
	.usa-legend {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border: 0;
	}

	// Hide fields that are marked as not visible
	[data-visible="false"] {
		display: none !important;
	}
	
	/* grid css */
	.field-wrapper {
		grid-column: span 12;

		// Column spans
		@for $i from 1 through 12 {
			&.col-#{$i} {
				grid-column: span #{$i};
			}
		}

		// Column offsets (using grid-column-start)
		@for $i from 1 through 11 {
			&.col-offset-#{$i} {
				grid-column-start: #{$i + 1};
			}
		}

		// Combined span and offset
		@for $offset from 1 through 11 {
			@for $span from 1 through 12 - $offset {
				&.col-offset-#{$offset}.col-#{$span} {
					grid-column: #{$offset + 1} / span #{$span};
				}
			}
		}
		
		button {
			width: 100%;
			max-width: fit-content
		}
	}

	// Panel wrapper grid layout (but NOT for horizontal-tabs which has its own layout)
	.panel-wrapper:not(.horizontal-tabs) {
		display: grid;
		grid-template-columns: repeat(12, minmax(0, 1fr));
		gap: 0 units(4);

		// Column spans for nested panels
		@for $i from 1 through 12 {
			&.col-#{$i} {
				grid-column: span #{$i};
			}
		}

		// Column offsets for nested panels
		@for $i from 1 through 11 {
			&.col-offset-#{$i} {
				grid-column-start: #{$i + 1};
			}
		}

		// When a panel is column-constrained (col-1 through col-11, or has inline grid-column style),
		// make all children full width within that panel - the inner grid should be 100% of the panel
		@for $i from 1 through 11 {
			&.col-#{$i} > .field-wrapper,
			&.col-#{$i} > .panel-wrapper {
				grid-column: span 12 !important;
			}
		}
	}

	// Panels with inline grid-column style (set via JS) should also have full-width children
	.panel-wrapper[style*="grid-column"] > .field-wrapper,
	.panel-wrapper[style*="grid-column"] > .panel-wrapper {
		grid-column: span 12 !important;
	}
	}
	
	.usa-form,
	.usa-label,
	.usa-input,
	.usa-checkbox__label,
	.usa-radio__label, 
	.field-description,
	.usa-hint {
		font-size: size('body', 5);
	}

	.usa-checkbox__label,
	.usa-radio__label {
		&:before {
			margin-top: math.div( ( line-height($theme-form-font-family, $theme-input-line-height) * font-size($theme-form-font-family, 'sm') - units( $theme-input-select-size ) ), 2 );
		}
	}

	.captcha-wrapper {
		display: none ;
	}
	
	.field-description {
		@include u-font-weight('bold');
		margin-top: units(.5);
		color: color('error-dark');
	}
	
	fieldset { // due to classes in aem forms, I need to override spacing for chrome 
		margin-top: units(3) !important; // stylelint-disable-line declaration-no-important
		
		legend {
			margin-top: 0 !important; // stylelint-disable-line declaration-no-important
		}
	}
}
